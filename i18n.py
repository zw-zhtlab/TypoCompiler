from typing import Callable, Dict, List, Tuple

SUPPORTED_LANGUAGES: Tuple[str, ...] = ("zh", "en", "ja", "ko", "es", "de", "fr")

DICT: Dict[str, Dict[str, str]] = {
    "en": {
        "app.title": "TypoCompiler",
        "menu.file": "File",
        "menu.settings": "Settings",
        "menu.run": "Run",
        "file.new": "New",
        "file.open": "Open...",
        "file.save": "Save",
        "file.save_as": "Save As...",
        "file.recent": "Recent Files",
        "file.exit": "Exit",
        "recent.empty": "(empty)",
        "settings.language": "Language",
        "settings.lang.zh": "Chinese",
        "settings.lang.en": "English",
        "settings.lang.ja": "Japanese",
        "settings.lang.ko": "Korean",
        "settings.lang.es": "Spanish",
        "settings.lang.de": "German",
        "settings.lang.fr": "French",
        "settings.default_style": "Default Error Style",
        "settings.manage_styles": "Manage Styles...",
        "settings.llm": "LLM Settings...",
        "settings.test_llm": "Test LLM",
        "settings.font": "Font Size",
        "settings.font.inc": "Increase",
        "settings.font.dec": "Decrease",
        "settings.font.reset": "Reset",
        "run.run": "Run",
        "run.choose_style": "Choose Style",
        "run.open": "Run",
        "run.window.title": "Compiler Output",
        "run.copy": "Copy",
        "run.save_log": "Save Log...",
        "run.close": "Close",
        "run.running": "Running...",
        "run.ready": "Ready",
        "run.no_output": "No compiler output (no issues detected).",
        "dialog.ok": "OK",
        "dialog.cancel": "Cancel",
        "dialog.yes": "Yes",
        "dialog.no": "No",
        "status.ready": "Ready",
        "status.loaded": "Loaded: {name}",
        "status.saved": "Saved: {name}",
        "status.testing_llm": "Testing LLM connectivity...",
        "msg.confirm_overwrite": "File exists. Overwrite?",
        "msg.save_failed": "Save failed: {err}",
        "msg.open_failed": "Open failed: {err}",
        "msg.config_saved": "Settings saved.",
        "msg.config_failed": "Failed to save settings: {err}",
        "msg.llm_test_ok": "LLM connectivity OK.",
        "msg.llm_test_fail": "LLM connectivity failed:\n{err}",
        "msg.llm_failed": "LLM request failed:\n{err}",
        "llm.title": "LLM Settings",
        "llm.base_url": "Base URL (OpenAI-compatible)",
        "llm.model": "Model",
        "llm.api_key": "API Key / Token",
        "llm.header_name": "Auth Header Name",
        "llm.header_prefix": "Auth Header Prefix",
        "llm.temperature": "Temperature",
        "llm.max_tokens": "Max Tokens",
        "llm.timeout": "Timeout (seconds)",
        "llm.security_note": "Note: API keys are stored locally in plain text. Prefer using a scoped token.",
        "styles.title": "Manage Styles",
        "styles.name": "Name",
        "styles.template": "Template",
        "styles.add": "Add",
        "styles.edit": "Edit",
        "styles.delete": "Delete",
        "styles.save": "Save",
        "styles.close": "Close",
        "styles.example_hint": "Template placeholders: {input_text}, {style_name}",
        "warn.no_text": "Please enter English natural-language text to 'compile'.",
        "warn.no_style": "No style selected.",
        "warn.unsaved": "You have unsaved changes. Discard them?",
        "warn.save_log_failed": "Failed to save log: {err}",
        "warn.copy_ok": "Copied to clipboard.",
        "warn.copy_failed": "Copy failed: {err}",
        "info.reset_defaults": "Configuration file was missing or corrupted and has been reset to defaults.",
    },
    "zh": {
        "app.title": "TypoCompiler",
        "menu.file": "文件",
        "menu.settings": "设置",
        "menu.run": "运行",
        "file.new": "新建",
        "file.open": "打开...",
        "file.save": "保存",
        "file.save_as": "另存为...",
        "file.recent": "最近文件",
        "file.exit": "退出",
        "recent.empty": "(空)",
        "settings.language": "界面语言",
        "settings.lang.zh": "中文",
        "settings.lang.en": "English",
        "settings.lang.ja": "日本語",
        "settings.lang.ko": "한국어",
        "settings.lang.es": "Español",
        "settings.lang.de": "Deutsch",
        "settings.lang.fr": "Français",
        "settings.default_style": "默认报错风格",
        "settings.manage_styles": "管理风格...",
        "settings.llm": "LLM 设置...",
        "settings.test_llm": "测试 LLM",
        "settings.font": "字号",
        "settings.font.inc": "增大",
        "settings.font.dec": "减小",
        "settings.font.reset": "重置",
        "run.run": "运行",
        "run.choose_style": "选择风格",
        "run.open": "运行",
        "run.window.title": "编译输出",
        "run.copy": "复制",
        "run.save_log": "保存日志...",
        "run.close": "关闭",
        "run.running": "运行中...",
        "run.ready": "就绪",
        "run.no_output": "无编译器输出（未检测到问题）。",
        "dialog.ok": "确定",
        "dialog.cancel": "取消",
        "dialog.yes": "是",
        "dialog.no": "否",
        "status.ready": "就绪",
        "status.loaded": "已加载: {name}",
        "status.saved": "已保存: {name}",
        "status.testing_llm": "正在测试 LLM 连通性...",
        "msg.confirm_overwrite": "文件已存在，是否覆盖？",
        "msg.save_failed": "保存失败: {err}",
        "msg.open_failed": "打开失败: {err}",
        "msg.config_saved": "设置已保存。",
        "msg.config_failed": "保存设置失败: {err}",
        "msg.llm_test_ok": "LLM 连通性正常。",
        "msg.llm_test_fail": "LLM 连通性失败:\n{err}",
        "msg.llm_failed": "LLM 请求失败:\n{err}",
        "llm.title": "LLM 设置",
        "llm.base_url": "基础地址（OpenAI 兼容）",
        "llm.model": "模型",
        "llm.api_key": "API Key / Token",
        "llm.header_name": "认证头名称",
        "llm.header_prefix": "认证头前缀",
        "llm.temperature": "温度",
        "llm.max_tokens": "最大 Token 数",
        "llm.timeout": "超时（秒）",
        "llm.security_note": "提示: API Key 会以明文保存在本地，建议使用权限受限的 Token。",
        "styles.title": "风格管理",
        "styles.name": "名称",
        "styles.template": "模板",
        "styles.add": "新增",
        "styles.edit": "编辑",
        "styles.delete": "删除",
        "styles.save": "保存",
        "styles.close": "关闭",
        "styles.example_hint": "模板占位符: {input_text}, {style_name}",
        "warn.no_text": "请输入要“编译”的英文自然语言文本。",
        "warn.no_style": "未选择风格。",
        "warn.unsaved": "当前有未保存更改，是否丢弃？",
        "warn.save_log_failed": "保存日志失败: {err}",
        "warn.copy_ok": "已复制到剪贴板。",
        "warn.copy_failed": "复制失败: {err}",
        "info.reset_defaults": "配置文件缺失或损坏，已重置为默认设置。",
    },
    "ja": {
        "app.title": "TypoCompiler",
        "menu.file": "ファイル",
        "menu.settings": "設定",
        "menu.run": "実行",
        "file.new": "新規作成",
        "file.open": "開く...",
        "file.save": "保存",
        "file.save_as": "名前を付けて保存...",
        "file.recent": "最近使ったファイル",
        "file.exit": "終了",
        "recent.empty": "(空)",
        "settings.language": "言語",
        "settings.lang.zh": "中国語",
        "settings.lang.en": "英語",
        "settings.lang.ja": "日本語",
        "settings.lang.ko": "韓国語",
        "settings.lang.es": "スペイン語",
        "settings.lang.de": "ドイツ語",
        "settings.lang.fr": "フランス語",
        "settings.default_style": "既定のエラースタイル",
        "settings.manage_styles": "スタイル管理...",
        "settings.llm": "LLM 設定...",
        "settings.test_llm": "LLM をテスト",
        "settings.font": "フォントサイズ",
        "settings.font.inc": "拡大",
        "settings.font.dec": "縮小",
        "settings.font.reset": "リセット",
        "run.run": "実行",
        "run.choose_style": "スタイルを選択",
        "run.open": "実行",
        "run.window.title": "コンパイラ出力",
        "run.copy": "コピー",
        "run.save_log": "ログを保存...",
        "run.close": "閉じる",
        "run.running": "実行中...",
        "run.ready": "準備完了",
        "run.no_output": "コンパイラ出力はありません（問題は検出されませんでした）。",
        "dialog.ok": "OK",
        "dialog.cancel": "キャンセル",
        "dialog.yes": "はい",
        "dialog.no": "いいえ",
        "status.ready": "準備完了",
        "status.loaded": "読み込み済み: {name}",
        "status.saved": "保存済み: {name}",
        "status.testing_llm": "LLM 接続をテスト中...",
        "msg.confirm_overwrite": "ファイルは既に存在します。上書きしますか？",
        "msg.save_failed": "保存に失敗しました: {err}",
        "msg.open_failed": "読み込みに失敗しました: {err}",
        "msg.config_saved": "設定を保存しました。",
        "msg.config_failed": "設定の保存に失敗しました: {err}",
        "msg.llm_test_ok": "LLM 接続は正常です。",
        "msg.llm_test_fail": "LLM 接続テストに失敗しました:\n{err}",
        "msg.llm_failed": "LLM リクエストに失敗しました:\n{err}",
        "llm.title": "LLM 設定",
        "llm.base_url": "ベース URL（OpenAI 互換）",
        "llm.model": "モデル",
        "llm.api_key": "API キー / トークン",
        "llm.header_name": "認証ヘッダー名",
        "llm.header_prefix": "認証ヘッダープレフィックス",
        "llm.temperature": "温度",
        "llm.max_tokens": "最大トークン数",
        "llm.timeout": "タイムアウト（秒）",
        "llm.security_note": "注: API キーはローカルに平文で保存されます。権限を限定したトークンの使用を推奨します。",
        "styles.title": "スタイル管理",
        "styles.name": "名前",
        "styles.template": "テンプレート",
        "styles.add": "追加",
        "styles.edit": "編集",
        "styles.delete": "削除",
        "styles.save": "保存",
        "styles.close": "閉じる",
        "styles.example_hint": "テンプレートのプレースホルダー: {input_text}, {style_name}",
        "warn.no_text": "「コンパイル」する英語の自然言語テキストを入力してください。",
        "warn.no_style": "スタイルが選択されていません。",
        "warn.unsaved": "未保存の変更があります。破棄しますか？",
        "warn.save_log_failed": "ログの保存に失敗しました: {err}",
        "warn.copy_ok": "クリップボードにコピーしました。",
        "warn.copy_failed": "コピーに失敗しました: {err}",
        "info.reset_defaults": "設定ファイルが見つからないか破損していたため、既定値にリセットしました。",
    },
    "ko": {
        "app.title": "TypoCompiler",
        "menu.file": "파일",
        "menu.settings": "설정",
        "menu.run": "실행",
        "file.new": "새로 만들기",
        "file.open": "열기...",
        "file.save": "저장",
        "file.save_as": "다른 이름으로 저장...",
        "file.recent": "최근 파일",
        "file.exit": "종료",
        "recent.empty": "(비어 있음)",
        "settings.language": "언어",
        "settings.lang.zh": "중국어",
        "settings.lang.en": "영어",
        "settings.lang.ja": "일본어",
        "settings.lang.ko": "한국어",
        "settings.lang.es": "스페인어",
        "settings.lang.de": "독일어",
        "settings.lang.fr": "프랑스어",
        "settings.default_style": "기본 오류 스타일",
        "settings.manage_styles": "스타일 관리...",
        "settings.llm": "LLM 설정...",
        "settings.test_llm": "LLM 테스트",
        "settings.font": "글꼴 크기",
        "settings.font.inc": "크게",
        "settings.font.dec": "작게",
        "settings.font.reset": "초기화",
        "run.run": "실행",
        "run.choose_style": "스타일 선택",
        "run.open": "실행",
        "run.window.title": "컴파일러 출력",
        "run.copy": "복사",
        "run.save_log": "로그 저장...",
        "run.close": "닫기",
        "run.running": "실행 중...",
        "run.ready": "준비됨",
        "run.no_output": "컴파일러 출력이 없습니다(문제가 감지되지 않음).",
        "dialog.ok": "확인",
        "dialog.cancel": "취소",
        "dialog.yes": "예",
        "dialog.no": "아니오",
        "status.ready": "준비됨",
        "status.loaded": "로드됨: {name}",
        "status.saved": "저장됨: {name}",
        "status.testing_llm": "LLM 연결을 테스트하는 중...",
        "msg.confirm_overwrite": "파일이 이미 존재합니다. 덮어쓸까요?",
        "msg.save_failed": "저장 실패: {err}",
        "msg.open_failed": "열기 실패: {err}",
        "msg.config_saved": "설정을 저장했습니다.",
        "msg.config_failed": "설정 저장 실패: {err}",
        "msg.llm_test_ok": "LLM 연결이 정상입니다.",
        "msg.llm_test_fail": "LLM 연결 테스트 실패:\n{err}",
        "msg.llm_failed": "LLM 요청 실패:\n{err}",
        "llm.title": "LLM 설정",
        "llm.base_url": "기본 URL(OpenAI 호환)",
        "llm.model": "모델",
        "llm.api_key": "API 키 / 토큰",
        "llm.header_name": "인증 헤더 이름",
        "llm.header_prefix": "인증 헤더 접두사",
        "llm.temperature": "온도",
        "llm.max_tokens": "최대 토큰",
        "llm.timeout": "시간 제한(초)",
        "llm.security_note": "참고: API 키는 로컬에 평문으로 저장됩니다. 범위가 제한된 토큰 사용을 권장합니다.",
        "styles.title": "스타일 관리",
        "styles.name": "이름",
        "styles.template": "템플릿",
        "styles.add": "추가",
        "styles.edit": "편집",
        "styles.delete": "삭제",
        "styles.save": "저장",
        "styles.close": "닫기",
        "styles.example_hint": "템플릿 자리표시자: {input_text}, {style_name}",
        "warn.no_text": "‘컴파일’할 영어 자연어 텍스트를 입력하세요.",
        "warn.no_style": "선택된 스타일이 없습니다.",
        "warn.unsaved": "저장되지 않은 변경 사항이 있습니다. 버릴까요?",
        "warn.save_log_failed": "로그 저장 실패: {err}",
        "warn.copy_ok": "클립보드에 복사되었습니다.",
        "warn.copy_failed": "복사 실패: {err}",
        "info.reset_defaults": "설정 파일이 없거나 손상되어 기본값으로 재설정되었습니다.",
    },
    "es": {
        "app.title": "TypoCompiler",
        "menu.file": "Archivo",
        "menu.settings": "Configuración",
        "menu.run": "Ejecutar",
        "file.new": "Nuevo",
        "file.open": "Abrir...",
        "file.save": "Guardar",
        "file.save_as": "Guardar como...",
        "file.recent": "Archivos recientes",
        "file.exit": "Salir",
        "recent.empty": "(vacío)",
        "settings.language": "Idioma",
        "settings.lang.zh": "Chino",
        "settings.lang.en": "Inglés",
        "settings.lang.ja": "Japonés",
        "settings.lang.ko": "Coreano",
        "settings.lang.es": "Español",
        "settings.lang.de": "Alemán",
        "settings.lang.fr": "Francés",
        "settings.default_style": "Estilo de error predeterminado",
        "settings.manage_styles": "Gestionar estilos...",
        "settings.llm": "Configuración de LLM...",
        "settings.test_llm": "Probar LLM",
        "settings.font": "Tamaño de fuente",
        "settings.font.inc": "Aumentar",
        "settings.font.dec": "Disminuir",
        "settings.font.reset": "Restablecer",
        "run.run": "Ejecutar",
        "run.choose_style": "Elegir estilo",
        "run.open": "Ejecutar",
        "run.window.title": "Salida del compilador",
        "run.copy": "Copiar",
        "run.save_log": "Guardar registro...",
        "run.close": "Cerrar",
        "run.running": "Ejecutando...",
        "run.ready": "Listo",
        "run.no_output": "Sin salida del compilador (no se detectaron problemas).",
        "dialog.ok": "Aceptar",
        "dialog.cancel": "Cancelar",
        "dialog.yes": "Sí",
        "dialog.no": "No",
        "status.ready": "Listo",
        "status.loaded": "Cargado: {name}",
        "status.saved": "Guardado: {name}",
        "status.testing_llm": "Probando conectividad de LLM...",
        "msg.confirm_overwrite": "El archivo ya existe. ¿Sobrescribir?",
        "msg.save_failed": "Error al guardar: {err}",
        "msg.open_failed": "Error al abrir: {err}",
        "msg.config_saved": "Configuración guardada.",
        "msg.config_failed": "Error al guardar la configuración: {err}",
        "msg.llm_test_ok": "Conectividad con LLM correcta.",
        "msg.llm_test_fail": "Conectividad con LLM fallida:\n{err}",
        "msg.llm_failed": "Solicitud LLM fallida:\n{err}",
        "llm.title": "Configuración de LLM",
        "llm.base_url": "URL base (compatible con OpenAI)",
        "llm.model": "Modelo",
        "llm.api_key": "API Key / Token",
        "llm.header_name": "Nombre del encabezado de autenticación",
        "llm.header_prefix": "Prefijo del encabezado de autenticación",
        "llm.temperature": "Temperatura",
        "llm.max_tokens": "Máx. tokens",
        "llm.timeout": "Tiempo de espera (segundos)",
        "llm.security_note": "Nota: las API keys se almacenan localmente en texto plano. Se recomienda usar un token con permisos limitados.",
        "styles.title": "Gestionar estilos",
        "styles.name": "Nombre",
        "styles.template": "Plantilla",
        "styles.add": "Añadir",
        "styles.edit": "Editar",
        "styles.delete": "Eliminar",
        "styles.save": "Guardar",
        "styles.close": "Cerrar",
        "styles.example_hint": "Marcadores de plantilla: {input_text}, {style_name}",
        "warn.no_text": "Introduce texto en lenguaje natural en inglés para 'compilar'.",
        "warn.no_style": "No se seleccionó ningún estilo.",
        "warn.unsaved": "Hay cambios sin guardar. ¿Deseas descartarlos?",
        "warn.save_log_failed": "Error al guardar el registro: {err}",
        "warn.copy_ok": "Copiado al portapapeles.",
        "warn.copy_failed": "Error al copiar: {err}",
        "info.reset_defaults": "El archivo de configuración faltaba o estaba dañado y se restableció a los valores predeterminados.",
    },
    "de": {
        "app.title": "TypoCompiler",
        "menu.file": "Datei",
        "menu.settings": "Einstellungen",
        "menu.run": "Ausführen",
        "file.new": "Neu",
        "file.open": "Öffnen...",
        "file.save": "Speichern",
        "file.save_as": "Speichern unter...",
        "file.recent": "Zuletzt verwendete Dateien",
        "file.exit": "Beenden",
        "recent.empty": "(leer)",
        "settings.language": "Sprache",
        "settings.lang.zh": "Chinesisch",
        "settings.lang.en": "Englisch",
        "settings.lang.ja": "Japanisch",
        "settings.lang.ko": "Koreanisch",
        "settings.lang.es": "Spanisch",
        "settings.lang.de": "Deutsch",
        "settings.lang.fr": "Französisch",
        "settings.default_style": "Standard-Fehlerstil",
        "settings.manage_styles": "Stile verwalten...",
        "settings.llm": "LLM-Einstellungen...",
        "settings.test_llm": "LLM testen",
        "settings.font": "Schriftgröße",
        "settings.font.inc": "Vergrößern",
        "settings.font.dec": "Verkleinern",
        "settings.font.reset": "Zurücksetzen",
        "run.run": "Ausführen",
        "run.choose_style": "Stil auswählen",
        "run.open": "Ausführen",
        "run.window.title": "Compiler-Ausgabe",
        "run.copy": "Kopieren",
        "run.save_log": "Protokoll speichern...",
        "run.close": "Schließen",
        "run.running": "Wird ausgeführt...",
        "run.ready": "Bereit",
        "run.no_output": "Keine Compiler-Ausgabe (keine Probleme erkannt).",
        "dialog.ok": "OK",
        "dialog.cancel": "Abbrechen",
        "dialog.yes": "Ja",
        "dialog.no": "Nein",
        "status.ready": "Bereit",
        "status.loaded": "Geladen: {name}",
        "status.saved": "Gespeichert: {name}",
        "status.testing_llm": "LLM-Verbindung wird getestet...",
        "msg.confirm_overwrite": "Datei existiert bereits. Überschreiben?",
        "msg.save_failed": "Speichern fehlgeschlagen: {err}",
        "msg.open_failed": "Öffnen fehlgeschlagen: {err}",
        "msg.config_saved": "Einstellungen gespeichert.",
        "msg.config_failed": "Speichern der Einstellungen fehlgeschlagen: {err}",
        "msg.llm_test_ok": "LLM-Verbindung ist OK.",
        "msg.llm_test_fail": "LLM-Verbindung fehlgeschlagen:\n{err}",
        "msg.llm_failed": "LLM-Anfrage fehlgeschlagen:\n{err}",
        "llm.title": "LLM-Einstellungen",
        "llm.base_url": "Basis-URL (OpenAI-kompatibel)",
        "llm.model": "Modell",
        "llm.api_key": "API-Key / Token",
        "llm.header_name": "Name des Auth-Headers",
        "llm.header_prefix": "Präfix des Auth-Headers",
        "llm.temperature": "Temperatur",
        "llm.max_tokens": "Max. Tokens",
        "llm.timeout": "Zeitlimit (Sekunden)",
        "llm.security_note": "Hinweis: API-Schlüssel werden lokal im Klartext gespeichert. Verwende nach Möglichkeit ein eingeschränktes Token.",
        "styles.title": "Stile verwalten",
        "styles.name": "Name",
        "styles.template": "Vorlage",
        "styles.add": "Hinzufügen",
        "styles.edit": "Bearbeiten",
        "styles.delete": "Löschen",
        "styles.save": "Speichern",
        "styles.close": "Schließen",
        "styles.example_hint": "Vorlagen-Platzhalter: {input_text}, {style_name}",
        "warn.no_text": "Bitte gib englischen Fließtext ein, um ihn zu 'kompilieren'.",
        "warn.no_style": "Kein Stil ausgewählt.",
        "warn.unsaved": "Es gibt ungespeicherte Änderungen. Verwerfen?",
        "warn.save_log_failed": "Protokoll konnte nicht gespeichert werden: {err}",
        "warn.copy_ok": "In die Zwischenablage kopiert.",
        "warn.copy_failed": "Kopieren fehlgeschlagen: {err}",
        "info.reset_defaults": "Die Konfigurationsdatei fehlte oder war beschädigt und wurde auf Standardwerte zurückgesetzt.",
    },
    "fr": {
        "app.title": "TypoCompiler",
        "menu.file": "Fichier",
        "menu.settings": "Paramètres",
        "menu.run": "Exécuter",
        "file.new": "Nouveau",
        "file.open": "Ouvrir...",
        "file.save": "Enregistrer",
        "file.save_as": "Enregistrer sous...",
        "file.recent": "Fichiers récents",
        "file.exit": "Quitter",
        "recent.empty": "(vide)",
        "settings.language": "Langue",
        "settings.lang.zh": "Chinois",
        "settings.lang.en": "Anglais",
        "settings.lang.ja": "Japonais",
        "settings.lang.ko": "Coréen",
        "settings.lang.es": "Espagnol",
        "settings.lang.de": "Allemand",
        "settings.lang.fr": "Français",
        "settings.default_style": "Style d'erreur par défaut",
        "settings.manage_styles": "Gérer les styles...",
        "settings.llm": "Paramètres LLM...",
        "settings.test_llm": "Tester le LLM",
        "settings.font": "Taille de police",
        "settings.font.inc": "Augmenter",
        "settings.font.dec": "Diminuer",
        "settings.font.reset": "Réinitialiser",
        "run.run": "Exécuter",
        "run.choose_style": "Choisir un style",
        "run.open": "Exécuter",
        "run.window.title": "Sortie du compilateur",
        "run.copy": "Copier",
        "run.save_log": "Enregistrer le journal...",
        "run.close": "Fermer",
        "run.running": "Exécution...",
        "run.ready": "Prêt",
        "run.no_output": "Aucune sortie du compilateur (aucun problème détecté).",
        "dialog.ok": "OK",
        "dialog.cancel": "Annuler",
        "dialog.yes": "Oui",
        "dialog.no": "Non",
        "status.ready": "Prêt",
        "status.loaded": "Chargé : {name}",
        "status.saved": "Enregistré : {name}",
        "status.testing_llm": "Test de la connectivité LLM...",
        "msg.confirm_overwrite": "Le fichier existe déjà. Écraser ?",
        "msg.save_failed": "Échec de l'enregistrement : {err}",
        "msg.open_failed": "Échec de l'ouverture : {err}",
        "msg.config_saved": "Paramètres enregistrés.",
        "msg.config_failed": "Échec de l'enregistrement des paramètres : {err}",
        "msg.llm_test_ok": "Connectivité LLM OK.",
        "msg.llm_test_fail": "Échec de la connectivité LLM :\n{err}",
        "msg.llm_failed": "Échec de la requête LLM :\n{err}",
        "llm.title": "Paramètres LLM",
        "llm.base_url": "URL de base (compatible OpenAI)",
        "llm.model": "Modèle",
        "llm.api_key": "Clé API / Jeton",
        "llm.header_name": "Nom de l'en-tête d'authentification",
        "llm.header_prefix": "Préfixe de l'en-tête d'authentification",
        "llm.temperature": "Température",
        "llm.max_tokens": "Tokens max",
        "llm.timeout": "Délai d'expiration (secondes)",
        "llm.security_note": "Note : les clés API sont stockées localement en clair. Préférez un jeton à portée limitée.",
        "styles.title": "Gérer les styles",
        "styles.name": "Nom",
        "styles.template": "Modèle",
        "styles.add": "Ajouter",
        "styles.edit": "Modifier",
        "styles.delete": "Supprimer",
        "styles.save": "Enregistrer",
        "styles.close": "Fermer",
        "styles.example_hint": "Paramètres de modèle : {input_text}, {style_name}",
        "warn.no_text": "Veuillez saisir un texte en anglais en langage naturel à 'compiler'.",
        "warn.no_style": "Aucun style sélectionné.",
        "warn.unsaved": "Vous avez des modifications non enregistrées. Les ignorer ?",
        "warn.save_log_failed": "Échec de l'enregistrement du journal : {err}",
        "warn.copy_ok": "Copié dans le presse-papiers.",
        "warn.copy_failed": "Échec de la copie : {err}",
        "info.reset_defaults": "Le fichier de configuration était manquant ou corrompu, il a été réinitialisé aux valeurs par défaut.",
    },
}

_current_lang: str = "zh"
_listeners: List[Callable[[str], None]] = []


def get_supported_languages() -> List[str]:
    return [lang for lang in SUPPORTED_LANGUAGES if lang in DICT]


def set_language(lang: str) -> None:
    global _current_lang
    if lang not in DICT:
        lang = "en"
    _current_lang = lang
    for cb in list(_listeners):
        try:
            cb(lang)
        except Exception:
            pass


def get_language() -> str:
    return _current_lang


def t(key: str, **kwargs) -> str:
    d = DICT.get(_current_lang, {})
    text = d.get(key, key)
    if kwargs:
        try:
            return text.format(**kwargs)
        except Exception:
            return text
    return text


def register_listener(callback: Callable[[str], None]) -> None:
    if callback not in _listeners:
        _listeners.append(callback)


def unregister_listener(callback: Callable[[str], None]) -> None:
    if callback in _listeners:
        _listeners.remove(callback)
